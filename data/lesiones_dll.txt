-- ==========================================================
-- üìò ESQUEMA BASE: Cat√°logos m√©dicos y anat√≥micos
-- ==========================================================

CREATE DATABASE IF NOT EXISTS control_lesiones
  CHARACTER SET utf8mb4
  COLLATE utf8mb4_general_ci;

USE control_lesiones;

-- ----------------------------------------------------------
-- 1Ô∏è‚É£ Segmentos corporales
-- ----------------------------------------------------------
CREATE TABLE segmentos_corporales (
  id_segmento INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(50) NOT NULL UNIQUE,
  descripcion TEXT DEFAULT NULL
) ENGINE=InnoDB;

-- ----------------------------------------------------------
-- 2Ô∏è‚É£ Zonas por segmento
-- ----------------------------------------------------------
CREATE TABLE zonas_segmento (
  id_zona INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(50) NOT NULL,
  id_segmento INT NOT NULL,
  FOREIGN KEY (id_segmento) REFERENCES segmentos_corporales(id_segmento)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  UNIQUE (nombre, id_segmento)
) ENGINE=InnoDB;

-- ----------------------------------------------------------
-- 3Ô∏è‚É£ Zonas anat√≥micas (subzonas)
-- ----------------------------------------------------------
CREATE TABLE zonas_anatomicas (
  id_subzona INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(80) NOT NULL,
  id_zona INT NOT NULL,
  FOREIGN KEY (id_zona) REFERENCES zonas_segmento(id_zona)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  UNIQUE (nombre, id_zona)
) ENGINE=InnoDB;

-- ----------------------------------------------------------
-- 4Ô∏è‚É£ Tipos de lesi√≥n
-- ----------------------------------------------------------
CREATE TABLE tipos_lesion (
  id_tipo INT AUTO_INCREMENT PRIMARY KEY,
  categoria VARCHAR(60) NOT NULL,    -- Ej: "MUSCULAR", "√ìSEA"
  nombre VARCHAR(80) NOT NULL,       -- Ej: "DISTENSI√ìN", "FRACTURA"
  UNIQUE (categoria, nombre)
) ENGINE=InnoDB;

-- ----------------------------------------------------------
-- 5Ô∏è‚É£ Tratamientos
-- ----------------------------------------------------------
CREATE TABLE tratamientos (
  id_tratamiento INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL UNIQUE,
  descripcion TEXT DEFAULT NULL
) ENGINE=InnoDB;

-- ----------------------------------------------------------
-- 6Ô∏è‚É£ Mecanismos de lesi√≥n
-- ----------------------------------------------------------
CREATE TABLE mecanismos_lesion (
  id_mecanismo INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL UNIQUE
) ENGINE=InnoDB;

-- ----------------------------------------------------------
-- 7Ô∏è‚É£ Lateralidades
-- ----------------------------------------------------------
CREATE TABLE lateralidades (
  id_lateralidad INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(20) NOT NULL UNIQUE
) ENGINE=InnoDB;

-- ----------------------------------------------------------
-- 8Ô∏è‚É£ Lugares de lesi√≥n
-- ----------------------------------------------------------
CREATE TABLE lugares_lesion (
  id_lugar INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(50) NOT NULL UNIQUE
) ENGINE=InnoDB;

-- ----------------------------------------------------------
-- 9Ô∏è‚É£ Gravedad (por d√≠as o cl√≠nica)
-- ----------------------------------------------------------
CREATE TABLE gravedad_lesion (
  id_gravedad INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(30) NOT NULL UNIQUE,    -- Ej: LEVE, MODERADA...
  dias_min INT DEFAULT NULL,
  dias_max INT DEFAULT NULL,
  tipo VARCHAR(30) DEFAULT 'D√çAS DE BAJA'  -- o 'CL√çNICA'
) ENGINE=InnoDB;

-- ----------------------------------------------------------
-- üîü Tipos de recidiva
-- ----------------------------------------------------------
CREATE TABLE tipos_recidiva (
  id_recidiva INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(30) NOT NULL UNIQUE
) ENGINE=InnoDB;

-- ----------------------------------------------------------
-- ü©∫ Tabla base de lesiones (ejemplo de integraci√≥n futura)
-- ----------------------------------------------------------
CREATE TABLE lesiones (
  id_lesion INT AUTO_INCREMENT PRIMARY KEY,
  id_jugadora INT NOT NULL,
  fecha DATE NOT NULL,
  id_segmento INT DEFAULT NULL,
  id_zona INT DEFAULT NULL,
  id_subzona INT DEFAULT NULL,
  id_tipo_lesion INT DEFAULT NULL,
  id_mecanismo INT DEFAULT NULL,
  id_lateralidad INT DEFAULT NULL,
  id_tratamiento INT DEFAULT NULL,
  id_gravedad INT DEFAULT NULL,
  id_recidiva INT DEFAULT NULL,
  observaciones TEXT DEFAULT NULL,
  FOREIGN KEY (id_segmento) REFERENCES segmentos_corporales(id_segmento)
    ON DELETE SET NULL
    ON UPDATE CASCADE,
  FOREIGN KEY (id_zona) REFERENCES zonas_segmento(id_zona)
    ON DELETE SET NULL
    ON UPDATE CASCADE,
  FOREIGN KEY (id_subzona) REFERENCES zonas_anatomicas(id_subzona)
    ON DELETE SET NULL
    ON UPDATE CASCADE,
  FOREIGN KEY (id_tipo_lesion) REFERENCES tipos_lesion(id_tipo)
    ON DELETE SET NULL
    ON UPDATE CASCADE,
  FOREIGN KEY (id_mecanismo) REFERENCES mecanismos_lesion(id_mecanismo)
    ON DELETE SET NULL
    ON UPDATE CASCADE,
  FOREIGN KEY (id_lateralidad) REFERENCES lateralidades(id_lateralidad)
    ON DELETE SET NULL
    ON UPDATE CASCADE,
  FOREIGN KEY (id_tratamiento) REFERENCES tratamientos(id_tratamiento)
    ON DELETE SET NULL
    ON UPDATE CASCADE,
  FOREIGN KEY (id_gravedad) REFERENCES gravedad_lesion(id_gravedad)
    ON DELETE SET NULL
    ON UPDATE CASCADE,
  FOREIGN KEY (id_recidiva) REFERENCES tipos_recidiva(id_recidiva)
    ON DELETE SET NULL
    ON UPDATE CASCADE,
  INDEX idx_jugadora_fecha (id_jugadora, fecha)
) ENGINE=InnoDB;

-- ==========================================================
-- ‚úÖ Esquema completo creado correctamente
-- ==========================================================
